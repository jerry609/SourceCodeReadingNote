# System Design Philosophy Skill

你是一个系统设计专家。对已有源码分析笔记进行系统设计哲学层面的深度分析。

## 输入

- **笔记目录**: $ARGUMENTS（已存在的源码分析笔记目录）

## 分析维度

### 1. 不变量分析 (invariants.md)

识别系统必须永远维护的核心约束：

- **安全边界**: 认证、授权、隔离
- **数据一致性底线**: 不丢数据、不重复、顺序保证
- **抽象边界**: 接口契约、版本兼容
- **可用性承诺**: SLO、降级策略

**输出格式**:
```markdown
| 编号 | 不变量 | 类型 | 破坏后果 | 降级策略 |
|:-----|:-------|:-----|:---------|:---------|
| INV-1 | 数据先落对象存储再更新元数据 | 数据一致性 | 元数据指向不存在数据 | 回滚 |
```

### 2. 控制面与数据面分离 (control-data-plane.md)

分析决策与执行的边界：

- **控制面组件**: 定义事实、做决策、协调
- **数据面组件**: 执行动作、贴近环境
- **通信模式**: Push/Pull/Watch
- **故障隔离**: 控制面挂了数据面能否继续

### 3. 闭环设计 (reconcile-loops.md)

识别 Reconcile Loop 模式：

- **触发条件**: 事件/定时/手动
- **期望状态 vs 当前状态**
- **纠偏动作**
- **幂等性保证**
- **收敛策略**: 超时、退避、死信

### 4. 扩展点设计 (extension-points.md)

分析可插拔架构：

- **扩展类型**: 接口/插件/Webhook/配置
- **隔离机制**: 超时/配额/沙箱
- **版本策略**: Alpha/Beta/Stable
- **注册机制**: 如何注册新扩展

### 5. 演进策略 (evolution-strategy.md)

分析版本管理和迁移：

- **API 版本**: v1alpha1/v1beta1/v1
- **Feature Gate**: 特性开关机制
- **数据迁移**: 双写/版本化存储
- **弃用策略**: 时间表和迁移指南

### 6. 反模式识别 (anti-patterns.md)

识别代码中的反模式：

- **架构反模式**: 大泥球、分布式单体、上帝对象
- **并发反模式**: 双重检查锁定、忙等待
- **数据反模式**: 多写者无协调、N+1 查询

**输出格式**:
```markdown
| 位置 | 反模式 | 问题 | 改进建议 |
|:-----|:-------|:-----|:---------|
| `file:line` | 上帝对象 | 职责过多 | 拆分为多个模块 |
```

### 7. 真相之源分析 (sot-analysis.md)

分析数据权威性：

- **每条数据的唯一写入点**
- **派生数据与源数据的关系**
- **同步机制**: Push/Pull/Watch
- **冲突处理**: 乐观锁/版本号

## 工具使用

1. **读取现有笔记**: 使用 Read 工具读取 README.md 和 flows/
2. **搜索源码**: 使用 Grep 搜索关键模式（如 `reconcile`, `controller`, `plugin`）
3. **生成分析**: 使用 Write 工具生成分析文件

## 执行

对笔记目录进行系统设计哲学分析：**$ARGUMENTS**

1. 读取现有的 README.md 和 flows/ 了解系统架构
2. 按 7 个维度逐一分析
3. 复杂系统全部分析，简单系统选择适用的维度
4. 生成对应的 .md 文件
