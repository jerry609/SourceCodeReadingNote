# 不变量分析 (Invariants)

> 系统不是为了"实现功能"，而是为了在变化、故障、需求冲突中维持少数关键不变量。
> 先说清楚：什么必须永远成立？其他东西都应该被允许变化。

## 不变量分类

- **安全边界**: 认证、授权、隔离
- **数据一致性底线**: 不丢数据、不重复、顺序保证
- **抽象边界**: 接口契约、版本兼容
- **可用性承诺**: SLO、降级策略

---

## 核心不变量清单

| 编号 | 不变量 | 类型 | 破坏后果 | 降级策略 |
|:-----|:-------|:-----|:---------|:---------|
| INV-1 | ... | 安全边界 | ... | ... |
| INV-2 | ... | 数据一致性 | ... | ... |
| INV-3 | ... | 抽象边界 | ... | ... |

---

## Invariant 1: [不变量名称]

### 描述
*用一句话描述这条不变量是什么*

### 为什么必须成立？
*业务上或技术上的必要性*

### 如何保证？
*代码中哪些机制在维护这条不变量？*

```go
// 关键代码片段
// 文件位置: path/to/file:line
```

### 破坏场景
*什么情况下可能被破坏？*
- 场景 1: ...
- 场景 2: ...

### 恢复策略
*破坏后如何恢复？*

*关联代码位置*: `path/to/file:line`

---

## Invariant 2: [不变量名称]

...

---

## 不变量验证

### 测试覆盖

| 不变量 | 单元测试 | 集成测试 | E2E 测试 | 混沌测试 |
|:-------|:---------|:---------|:---------|:---------|
| INV-1 | Yes/No | Yes/No | Yes/No | Yes/No |

### 运行时检查

*是否有运行时断言/监控来检测不变量被破坏？*

---

## 总结

| 不变量 | 重要程度 | 维护难度 | 当前状态 |
|:-------|:---------|:---------|:---------|
| INV-1 | 高/中/低 | 高/中/低 | 健康/风险/问题 |
