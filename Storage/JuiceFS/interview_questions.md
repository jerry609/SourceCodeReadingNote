# JuiceFS 面试题库

> 作为 JuiceFS 面试官，我会从以下维度考察候选人对分布式文件系统的理解。
> 难度标记：⭐ 基础 | ⭐⭐ 中级 | ⭐⭐⭐ 高级 | ⭐⭐⭐⭐ 专家

---

## 一、架构设计 (Architecture)

### 1.1 整体架构
| # | 问题 | 难度 | 考察点 |
|---|------|------|--------|
| 1 | JuiceFS 的核心架构是什么？为什么选择元数据与数据分离的设计？ | ⭐ | 架构理解 |
| 2 | 对比 HDFS、CephFS、JuiceFS 的架构差异，各自的优劣是什么？ | ⭐⭐ | 系统对比 |
| 3 | JuiceFS Client 包含哪些主要模块？它们是如何协作的？ | ⭐⭐ | 模块划分 |
| 4 | 为什么 JuiceFS 选择在客户端实现缓存，而不是在服务端？ | ⭐⭐ | 设计决策 |
| 5 | JuiceFS 如何实现"无限扩展"？有哪些扩展瓶颈？ | ⭐⭐⭐ | 扩展性 |

### 1.2 数据分层
| # | 问题 | 难度 | 考察点 |
|---|------|------|--------|
| 6 | 解释 JuiceFS 的数据分层：Chunk、Slice、Block、Page 的关系 | ⭐ | 数据模型 |
| 7 | 为什么 Chunk 选择 64MB？Block 选择 4MB？这些数字是如何确定的？ | ⭐⭐ | 参数选择 |
| 8 | 如果让你重新设计，会选择固定块大小还是可变块大小？为什么？ | ⭐⭐⭐ | 设计权衡 |
| 9 | Slice 和 Block 的区别是什么？为什么需要 Slice 这个抽象？ | ⭐⭐ | 概念理解 |

---

## 二、元数据引擎 (Metadata Engine)

### 2.1 接口设计
| # | 问题 | 难度 | 考察点 |
|---|------|------|--------|
| 10 | Meta 接口有 60+ 方法，这样设计的优缺点是什么？ | ⭐⭐ | 接口设计 |
| 11 | 如果新增一个元数据后端（如 etcd），需要实现哪些核心方法？ | ⭐⭐ | 扩展能力 |
| 12 | `baseMeta` 的作用是什么？它使用了什么设计模式？ | ⭐⭐ | 设计模式 |
| 13 | Attr 结构体为什么使用二进制序列化而不是 JSON/Protobuf？ | ⭐⭐ | 序列化 |

### 2.2 Redis 后端
| # | 问题 | 难度 | 考察点 |
|---|------|------|--------|
| 14 | Redis 后端的数据模型是怎样的？用了哪些 Redis 数据结构？ | ⭐⭐ | 数据模型 |
| 15 | 为什么 Lookup 操作使用 Lua 脚本？带来了多少性能提升？ | ⭐⭐ | 性能优化 |
| 16 | Lua 脚本中 inode 为什么有 2^52 的限制？如何解决？ | ⭐⭐⭐ | 边界问题 |
| 17 | Redis Cluster 模式下，JuiceFS 如何保证事务的原子性？ | ⭐⭐⭐ | 分布式事务 |
| 18 | Redis Client-Side Caching 是如何工作的？适用什么场景？ | ⭐⭐⭐ | 缓存一致性 |

### 2.3 SQL 后端
| # | 问题 | 难度 | 考察点 |
|---|------|------|--------|
| 19 | SQL 后端的表结构是怎样设计的？与 Redis 有什么差异？ | ⭐⭐ | 数据模型 |
| 20 | MySQL 和 PostgreSQL 后端在实现上有什么区别？ | ⭐⭐ | 多数据库适配 |
| 21 | SQL 后端如何处理高并发写入？有哪些锁机制？ | ⭐⭐⭐ | 并发控制 |

### 2.4 TiKV 后端
| # | 问题 | 难度 | 考察点 |
|---|------|------|--------|
| 22 | TiKV 后端相比 Redis/SQL 有什么优势？适合什么场景？ | ⭐⭐ | 后端选型 |
| 23 | TiKV 的 MVCC 特性如何被 JuiceFS 利用？ | ⭐⭐⭐ | 事务模型 |
| 24 | kvMeta 接口与 dbMeta 接口的设计差异是什么？ | ⭐⭐⭐ | 抽象设计 |

---

## 三、数据存储 (Data Storage)

### 3.1 对象存储抽象
| # | 问题 | 难度 | 考察点 |
|---|------|------|--------|
| 25 | ObjectStorage 接口定义了哪些方法？为什么需要这层抽象？ | ⭐ | 接口设计 |
| 26 | 如何添加一个新的对象存储后端？需要实现哪些方法？ | ⭐⭐ | 扩展能力 |
| 27 | 分片上传 (Multipart Upload) 是如何实现的？分片大小如何选择？ | ⭐⭐ | 大文件处理 |
| 28 | 对象存储的 Key 是如何命名的？HashPrefix 模式有什么好处？ | ⭐⭐ | 命名策略 |
| 29 | 如果对象存储出现短暂不可用，JuiceFS 如何处理？ | ⭐⭐⭐ | 容错机制 |

### 3.2 数据压缩与加密
| # | 问题 | 难度 | 考察点 |
|---|------|------|--------|
| 30 | JuiceFS 支持哪些压缩算法？它们各自的特点是什么？ | ⭐⭐ | 压缩策略 |
| 31 | 压缩后如何支持 Range Request？这里有什么挑战？ | ⭐⭐⭐ | 设计挑战 |
| 32 | 数据加密是在哪一层实现的？密钥如何管理？ | ⭐⭐⭐ | 安全设计 |

---

## 四、缓存系统 (Caching)

### 4.1 缓存架构
| # | 问题 | 难度 | 考察点 |
|---|------|------|--------|
| 33 | JuiceFS 有哪几层缓存？它们的作用分别是什么？ | ⭐ | 缓存层次 |
| 34 | 内存缓存和磁盘缓存的数据结构有什么区别？ | ⭐⭐ | 数据结构 |
| 35 | Page Pool 是如何实现内存复用的？为什么用 channel？ | ⭐⭐ | 内存管理 |

### 4.2 缓存淘汰
| # | 问题 | 难度 | 考察点 |
|---|------|------|--------|
| 36 | JuiceFS 支持哪些缓存淘汰策略？各自的实现原理是什么？ | ⭐⭐ | 淘汰策略 |
| 37 | 2-Random 算法是什么？为什么不用标准 LRU？ | ⭐⭐⭐ | 算法选择 |
| 38 | LRU 用 MinHeap 实现有什么好处？时间复杂度是多少？ | ⭐⭐ | 数据结构 |

### 4.3 缓存一致性
| # | 问题 | 难度 | 考察点 |
|---|------|------|--------|
| 39 | 多客户端场景下，如何保证缓存一致性？ | ⭐⭐⭐ | 分布式一致性 |
| 40 | TTL 过期和主动失效各有什么优缺点？ | ⭐⭐ | 设计权衡 |
| 41 | 如果缓存数据与对象存储不一致，会发生什么？如何检测？ | ⭐⭐⭐ | 数据校验 |

---

## 五、读写路径 (I/O Path)

### 5.1 读操作
| # | 问题 | 难度 | 考察点 |
|---|------|------|--------|
| 42 | 描述一次完整的文件读取流程，从 FUSE 到对象存储 | ⭐⭐ | 读路径 |
| 43 | Singleflight 是什么？它解决了什么问题？ | ⭐⭐ | 并发优化 |
| 44 | 预读 (Prefetch) 是如何触发的？如何避免浪费带宽？ | ⭐⭐ | 预读策略 |
| 45 | Range Request 在什么情况下会使用？阈值是多少？ | ⭐⭐ | 读优化 |
| 46 | SliceReader 的状态机是如何设计的？各状态的含义？ | ⭐⭐⭐ | 状态管理 |

### 5.2 写操作
| # | 问题 | 难度 | 考察点 |
|---|------|------|--------|
| 47 | 描述一次完整的文件写入流程，从 FUSE 到对象存储 | ⭐⭐ | 写路径 |
| 48 | 同步写入和 Writeback 模式有什么区别？各自的适用场景？ | ⭐⭐ | 写模式 |
| 49 | Writeback 模式下，数据丢失的风险有多大？如何降低？ | ⭐⭐⭐ | 数据安全 |
| 50 | Staging 目录的作用是什么？重启后如何恢复？ | ⭐⭐ | 故障恢复 |
| 51 | 写入过程中 Block 是如何积累和上传的？ | ⭐⭐ | 写流程 |

### 5.3 Compact
| # | 问题 | 难度 | 考察点 |
|---|------|------|--------|
| 52 | 什么情况下会触发 Chunk Compact？阈值是多少？ | ⭐⭐ | 触发条件 |
| 53 | Compact 时 skipSome 函数的作用是什么？ | ⭐⭐⭐ | 算法优化 |
| 54 | Slice 重叠是如何处理的？cut 算法是如何工作的？ | ⭐⭐⭐ | 核心算法 |
| 55 | Compact 失败会有什么影响？如何保证原子性？ | ⭐⭐⭐ | 一致性 |

---

## 六、FUSE 与 VFS

### 6.1 FUSE 基础
| # | 问题 | 难度 | 考察点 |
|---|------|------|--------|
| 56 | FUSE 的工作原理是什么？有哪些性能开销？ | ⭐⭐ | FUSE 原理 |
| 57 | JuiceFS 使用的是 high-level 还是 low-level FUSE API？ | ⭐⭐ | FUSE API |
| 58 | writeback_cache 模式有什么特殊之处？为什么 WRONLY 也需要 reader？ | ⭐⭐⭐ | FUSE 特性 |
| 59 | 如何通知内核使缓存失效？有哪几种失效类型？ | ⭐⭐⭐ | 内核交互 |

### 6.2 VFS 层
| # | 问题 | 难度 | 考察点 |
|---|------|------|--------|
| 60 | VFS 层的职责是什么？为什么需要这一层抽象？ | ⭐⭐ | 分层设计 |
| 61 | 文件句柄 (handle) 包含哪些信息？生命周期是怎样的？ | ⭐⭐ | 句柄管理 |
| 62 | 句柄的读写锁是如何实现的？为什么需要 readers/writers 计数？ | ⭐⭐⭐ | 并发控制 |
| 63 | 热升级是如何实现的？状态如何序列化和恢复？ | ⭐⭐⭐ | 热升级 |

### 6.3 内部节点
| # | 问题 | 难度 | 考察点 |
|---|------|------|--------|
| 64 | JuiceFS 有哪些内部特殊节点？它们的作用是什么？ | ⭐⭐ | 内部机制 |
| 65 | .control 文件是如何实现 CLI 交互的？ | ⭐⭐ | 进程通信 |
| 66 | .stats 文件导出哪些指标？如何与 Prometheus 集成？ | ⭐⭐ | 监控 |

---

## 七、分布式特性

### 7.1 锁机制
| # | 问题 | 难度 | 考察点 |
|---|------|------|--------|
| 67 | JuiceFS 支持哪些 POSIX 锁？BSD 锁和 OFD 锁有什么区别？ | ⭐⭐ | 文件锁 |
| 68 | 分布式锁是如何实现的？Redis/SQL/TiKV 各自怎么做？ | ⭐⭐⭐ | 分布式锁 |
| 69 | 客户端意外退出，锁如何释放？Session 机制是怎样的？ | ⭐⭐⭐ | 故障处理 |

### 7.2 配额与权限
| # | 问题 | 难度 | 考察点 |
|---|------|------|--------|
| 70 | JuiceFS 支持哪些配额类型？如何统计使用量？ | ⭐⭐ | 配额管理 |
| 71 | ACL 是如何存储的？性能影响有多大？ | ⭐⭐ | 权限控制 |
| 72 | 多租户隔离是如何实现的？有哪些隔离级别？ | ⭐⭐⭐ | 多租户 |

### 7.3 会话管理
| # | 问题 | 难度 | 考察点 |
|---|------|------|--------|
| 73 | Session 的作用是什么？心跳机制是怎样的？ | ⭐⭐ | 会话管理 |
| 74 | 如何检测和清理过期 Session？对性能有什么影响？ | ⭐⭐ | 会话清理 |
| 75 | 客户端断网重连后，Session 如何恢复？ | ⭐⭐⭐ | 故障恢复 |

---

## 八、运维与工具

### 8.1 CLI 命令
| # | 问题 | 难度 | 考察点 |
|---|------|------|--------|
| 76 | juicefs gc 命令做什么？有哪些模式？ | ⭐⭐ | 垃圾回收 |
| 77 | juicefs fsck 能检测哪些问题？如何修复？ | ⭐⭐ | 一致性检查 |
| 78 | juicefs dump/load 的作用是什么？适用什么场景？ | ⭐⭐ | 备份恢复 |
| 79 | juicefs warmup 是如何工作的？适合什么场景？ | ⭐⭐ | 缓存预热 |

### 8.2 监控与调试
| # | 问题 | 难度 | 考察点 |
|---|------|------|--------|
| 80 | JuiceFS 导出哪些关键指标？如何诊断性能问题？ | ⭐⭐ | 监控 |
| 81 | 如何分析 JuiceFS 的读写延迟瓶颈？ | ⭐⭐⭐ | 性能调优 |
| 82 | Access Log 记录哪些信息？如何用于问题排查？ | ⭐⭐ | 日志分析 |

### 8.3 数据迁移
| # | 问题 | 难度 | 考察点 |
|---|------|------|--------|
| 83 | juicefs sync 的工作原理是什么？如何保证一致性？ | ⭐⭐ | 数据同步 |
| 84 | 如何从一个对象存储迁移到另一个？元数据如何处理？ | ⭐⭐⭐ | 迁移方案 |

---

## 九、性能优化

### 9.1 读性能
| # | 问题 | 难度 | 考察点 |
|---|------|------|--------|
| 85 | 顺序读和随机读的性能差异有多大？原因是什么？ | ⭐⭐ | 读性能 |
| 86 | 如何优化小文件读取性能？有哪些参数可以调？ | ⭐⭐⭐ | 小文件优化 |
| 87 | 缓存命中率对性能的影响有多大？如何提升命中率？ | ⭐⭐ | 缓存优化 |

### 9.2 写性能
| # | 问题 | 难度 | 考察点 |
|---|------|------|--------|
| 88 | 写入性能受哪些因素影响？瓶颈通常在哪里？ | ⭐⭐ | 写性能 |
| 89 | 批量小文件写入有什么优化策略？ | ⭐⭐⭐ | 小文件优化 |
| 90 | max-uploads 参数的作用是什么？如何选择合适的值？ | ⭐⭐ | 参数调优 |

### 9.3 元数据性能
| # | 问题 | 难度 | 考察点 |
|---|------|------|--------|
| 91 | 元数据操作的延迟主要来自哪里？如何优化？ | ⭐⭐ | 元数据性能 |
| 92 | 目录下有百万文件时，ls 性能如何？如何优化？ | ⭐⭐⭐ | 大目录优化 |
| 93 | 元数据缓存 (entry-cache, attr-cache) 如何配置？ | ⭐⭐ | 缓存配置 |

---

## 十、场景设计题

### 10.1 系统设计
| # | 问题 | 难度 | 考察点 |
|---|------|------|--------|
| 94 | 如果让你设计一个支持 10PB 数据的文件系统，你会如何设计？ | ⭐⭐⭐⭐ | 系统设计 |
| 95 | 如何设计一个跨地域的分布式文件系统？数据如何分布？ | ⭐⭐⭐⭐ | 跨地域 |
| 96 | 如何在 JuiceFS 上支持快照功能？技术挑战是什么？ | ⭐⭐⭐⭐ | 功能扩展 |

### 10.2 故障处理
| # | 问题 | 难度 | 考察点 |
|---|------|------|--------|
| 97 | 元数据引擎 (Redis) 宕机，会发生什么？如何恢复？ | ⭐⭐⭐ | 故障处理 |
| 98 | 对象存储数据损坏，如何检测和修复？ | ⭐⭐⭐ | 数据修复 |
| 99 | 客户端和服务端时钟不同步，会有什么问题？ | ⭐⭐⭐ | 时钟问题 |

### 10.3 扩展设计
| # | 问题 | 难度 | 考察点 |
|---|------|------|--------|
| 100 | 如果要用 Rust 重写 JuiceFS，你会如何设计模块结构？ | ⭐⭐⭐⭐ | 语言迁移 |

---

## 评分标准参考

### 初级工程师 (Junior)
- 能回答 ⭐ 和部分 ⭐⭐ 问题
- 理解基本架构和数据流
- 会使用 CLI 命令

### 中级工程师 (Mid-level)
- 能回答大部分 ⭐⭐ 问题
- 理解核心模块的实现
- 能分析性能问题

### 高级工程师 (Senior)
- 能回答 ⭐⭐⭐ 问题
- 理解设计权衡和决策原因
- 能设计新功能

### 专家 (Expert)
- 能回答 ⭐⭐⭐⭐ 问题
- 能从系统层面分析问题
- 能设计类似系统

---

## 参考答案索引

大部分问题的答案可以在以下文档中找到：
- [questions.md](questions.md) - 20+ 已解答问题
- [algorithms.md](algorithms.md) - 核心算法详解
- [tradeoffs.md](tradeoffs.md) - 设计决策分析
- [highlights.md](highlights.md) - 惊艳设计
- [modules/](modules/) - 模块详解
- [flows/](flows/) - 关键路径分析
